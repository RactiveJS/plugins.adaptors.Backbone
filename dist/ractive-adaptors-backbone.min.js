(function(e,n){typeof exports==="object"&&typeof module!=="undefined"?module.exports=n():typeof define==="function"&&define.amd?define(n):e.Ractive.adaptors.Backbone=n()})(this,function(){"use strict";var e="_ractiveAdaptorsBackboneLock";function n(n){n[e]=(n[e]||0)+1;return function t(){n[e]-=1;if(!n[e]){delete n[e]}}}function t(n){return!!n[e]}var o={Backbone:typeof window!=="undefined"&&window.Backbone||null,filter:function c(e){if(!o.Backbone){throw new Error("Could not find Backbone. You must do `adaptor.Backbone = Backbone` - see https://github.com/ractivejs/ractive-adaptors-backbone#installation for more information")}return e instanceof o.Backbone.Model||e instanceof o.Backbone.Collection},wrap:function s(e,n,t,r){if(n instanceof o.Backbone.Model){return new a(e,n,t,r)}return new i(e,n,t,r)}};function a(e,t,o,a){this.value=t;t.on("change",this.modelChangeHandler=function(){var o=n(t);e.set(a(t.changed));o()})}a.prototype={teardown:function f(){this.value.off("change",this.modelChangeHandler)},get:function u(){return this.value.toJSON()},set:function d(e,n){if(!t(this.value)&&("AssociatedModel"in o.Backbone&&this.value instanceof o.Backbone.AssociatedModel||e.indexOf(".")===-1)){this.value.set(e,n)}},reset:function l(e){if(e instanceof o.Backbone.Model||!(e instanceof Object)){return false}this.value.set(e)}};function i(e,t,o){this.value=t;t.on("add remove reset sort",this.changeHandler=function(){var a=n(t);e.set(o,t.models);a()})}i.prototype={teardown:function h(){this.value.off("add remove reset sort",this.changeHandler)},get:function v(){return this.value.models},reset:function b(e){if(t(this.value)){return}if(e instanceof o.Backbone.Collection||Object.prototype.toString.call(e)!=="[object Array]"){return false}this.value.reset(e)}};var r=o;return r});