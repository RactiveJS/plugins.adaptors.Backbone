(function(e,t){"use strict";if(typeof module!=="undefined"&&module.exports&&typeof require==="function"){t(require("ractive"),require("backbone"))}else if(typeof define==="function"&&define.amd){define(["ractive","backbone"],t)}else if(e.Ractive&&e.Backbone){t(e.Ractive,e.Backbone)}else{throw new Error("Could not find Ractive or Backbone! Both must be loaded before the ractive-adaptors-backbone plugin")}})(typeof window!=="undefined"?window:this,function(e,t){"use strict";var n,r;var o="_ractiveAdaptorsBackboneLock";var i="_ractiveAdaptorsBackboneOriginalSync";var a="BackboneCollectionWrapper:change";if(!e||!t){throw new Error("Could not find Ractive or Backbone! Check your paths config")}function c(e,t){var n=o+(t||"");e[n]=(e[n]||0)+1;return function r(){e[n]-=1;if(!e[n]){delete e[n]}}}function s(e,t){var n=o+(t||"");return!!e[n]}e.adaptors.Backbone={filter:function(e){return e instanceof t.Model||e instanceof t.Collection},wrap:function(e,o,i,a){if(o instanceof t.Model){return new n(e,o,i,a)}return new r(e,o,i,a)}};n=function(e,t,n,r){this.value=t;t.on("change",this.modelChangeHandler=function(){var n=c(t,"set");e.set(r(t.changed));n()})};n.prototype={teardown:function(){this.value.off("change",this.modelChangeHandler)},get:function(){return this.value.attributes},set:function(e,t){if(!s(this.value,"set")&&e.indexOf(".")===-1){this.value.set(e,t)}},reset:function(e){if(e instanceof t.Model||!(e instanceof Object)){return false}this.value.set(e)}};r=function(e,t,n){this.value=t;var r=this.changeHandler=function(){if(s(t,"syncSuccess")){return}var r=c(t,"set");e.set(n,t.models);r()};t.on("add remove reset sort "+a,r);if(!t.hasOwnProperty(i)){var o=t.sync;t[i]=t.hasOwnProperty("sync")?o:null;t.sync=function u(e,n,r){r=r||{};var i=r.success;if(i){r.success=function(e){var n=c(t,"syncSuccess");var r=i.apply(this,arguments);n();t.trigger(a);return r}}return o.apply(this,arguments)}}this.releaseSyncPatch=c(t,"syncPatch")};r.prototype={teardown:function(){var e=this.value;this.releaseSyncPatch();if(!s(e,"syncPatch")){if(e[i]){e.sync=e[i];delete e[i]}else{delete e.sync}}this.value.off("add remove reset sort "+a,this.changeHandler)},get:function(){return this.value.models},reset:function(e){if(s(this.value,"set")){return}if(e instanceof t.Collection||Object.prototype.toString.call(e)!=="[object Array]"){return false}this.value.reset(e)}}});