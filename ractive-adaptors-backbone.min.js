(function(e,t){"use strict";if(typeof module!=="undefined"&&module.exports&&typeof require==="function"){t(require("ractive"),require("backbone"))}else if(typeof define==="function"&&define.amd){define(["ractive","backbone"],t)}else if(e.Ractive&&e.Backbone){t(e.Ractive,e.Backbone)}else{throw new Error("Could not find Ractive or Backbone! Both must be loaded before the ractive-adaptors-backbone plugin")}})(typeof window!=="undefined"?window:this,function(e,t){"use strict";var n,o;var r="_ractiveAdaptorsBackboneLock";var i="_ractiveAdaptorsBackboneOriginalSet";var a="BackboneCollectionWrapper:change";if(!e||!t){throw new Error("Could not find Ractive or Backbone! Check your paths config")}function s(e,t){var n=r+(t||"");e[n]=(e[n]||0)+1;return function o(){e[n]-=1;if(!e[n]){delete e[n]}}}function c(e,t){var n=r+(t||"");return!!e[n]}function f(e){var t=Array.prototype.slice.call(arguments,1);e.on.apply(e,t);return function n(){e.off.apply(e,t)}}e.adaptors.Backbone={filter:function(e){return e instanceof t.Model||e instanceof t.Collection},wrap:function(e,r,i,a){if(r instanceof t.Model){return new n(e,r,i,a)}return new o(e,r,i,a)}};n=function(e,t,n,o){this.value=t;this.off=f(t,"change",function(){var n=s(t,"set");e.set(o(t.changed));n()})};n.prototype={teardown:function(){this.off()},get:function(){return this.value.attributes},set:function(e,t){if(!c(this.value,"set")&&e.indexOf(".")===-1){this.value.set(e,t)}},reset:function(e){if(e instanceof t.Model||!(e instanceof Object)){return false}this.value.set(e)}};o=function(e,t,n){this.value=t;function o(){if(c(t,"setSuccess")){return}var o=s(t,"set");e.set(n,t.models);o()}this.off=f(t,"add remove reset sort "+a,o);if(!t.hasOwnProperty(i)){var r=t.set;t[i]=t.hasOwnProperty("set")?r:null;t.set=function u(e,n){var o=s(t,"setSuccess");var i=r.apply(this,arguments);o();t.trigger(a);return i}}this.releaseSetPatch=s(t,"setPatch")};o.prototype={teardown:function(){var e=this.value;this.releaseSetPatch();if(!c(e,"setPatch")){if(e[i]){e.set=e[i];delete e[i]}else{delete e.set}}this.off()},get:function(){return this.value.models},reset:function(e){if(c(this.value,"set")){return}if(e instanceof t.Collection||Object.prototype.toString.call(e)!=="[object Array]"){return false}this.value.reset(e)}}});