(function(e,n){"use strict";if(typeof module!=="undefined"&&module.exports&&typeof require==="function"){n(require("ractive"),require("underscore"),require("backbone"))}else if(typeof define==="function"&&define.amd){define(["ractive","underscore","backbone"],n)}else if(e.Ractive&&e.Backbone){n(e.Ractive,e._,e.Backbone)}else{throw new Error("Could not find Ractive or Backbone! Both must be loaded before the ractive-adaptors-backbone plugin")}})(typeof window!=="undefined"?window:this,function(e,n,t){"use strict";var o,i,r="_ractiveAdaptorsBackboneLock";if(!e||!t){throw new Error("Could not find Ractive or Backbone! Check your paths config")}function a(e){e[r]=(e[r]||0)+1;return function n(){e[r]-=1;if(!e[r]){delete e[r]}}}function c(e){return!!e[r]}e.adaptors.Backbone={filter:function(e){return e instanceof t.Model||e instanceof t.Collection},wrap:function(e,n,r,a){if(n instanceof t.Model){return new o(e,n,r,a)}return new i(e,n,r,a)}};o=function(e,t,o,i){this.value=t;var r={};var c=n.debounce(function(){var n=a(t);e.set(i(r));n();r={}},0);t.on("change",this.modelChangeHandler=function(){n.extend(r,t.changed);c()})};o.prototype={teardown:function(){this.value.off("change",this.modelChangeHandler)},get:function(){return this.value.attributes},set:function(e,n){if(!c(this.value)&&e.indexOf(".")===-1){this.value.set(e,n)}},reset:function(e){if(e instanceof t.Model||!(e instanceof Object)){return false}this.value.set(e)}};i=function(e,t,o){this.value=t;t.on("add remove reset sort",this.changeHandler=n.debounce(function(){var n=a(t);e.set(o,t.models);n()},0))};i.prototype={teardown:function(){this.value.off("add remove reset sort",this.changeHandler)},get:function(){return this.value.models},reset:function(e){if(c(this.value)){return}if(e instanceof t.Collection||Object.prototype.toString.call(e)!=="[object Array]"){return false}this.value.reset(e)}}});